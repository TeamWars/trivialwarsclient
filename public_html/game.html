<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="icon" type="image/png" href="resources/images/favicon.ico" />
        <link rel="stylesheet" href="resources/css/tablero/game.css" />
        <!--<script type="text/javascript" src="resources/js/libs/jquery-1.9.0/jquery.min.js"></script>-->
        <script src="resources/js/jqueryui/jquery-1.10.2.js"></script>
        <script src="resources/js/jqueryui/jquery-ui-1.10.4.custom.js"></script>
        <link href="resources/css/dialog/jquery-ui-1.10.4.custom.css" rel="stylesheet">
        <title>Trivial Wars</title>
        <style type="text/css">
            @font-face
            {
                font-family: "starwars";
                src: url("resources/fonts/Starjhol.ttf");
            }
            body{
                background-image: url("resources/images/fondo.jpg");
            }
            #registroUsuarios{
                background-image: url("resources/images/backgroundFormIndex.png");
                background-repeat: no-repeat;
                background-size: 100%;
            }


        </style>
        <script type="text/javascript">
            var fichaSelec = "";
            var nombrePartida = "";
            var numJugadores = "";
            var idUsuario = "";
            var socket = io.connect("http://localhost:8080");
            
            function fichaSeleccionada(nombre, fichero) {
                $('#nameFich').val(nombre);
                fichaSelec = fichero;
                $("img").css("opacity", "0.5");
                palabras = fichero.split(".");
                nombre = palabras[0];
                $("#" + nombre).find("img").css("opacity", "1");
            }
            
//            function fichaSeleccionada(nombre, fichero) {
//                nombreFicha = fichero;
//                todoSeleccionado = true;
//            }

            function confirmarDatosPartida() {
                var valido = validarDatos();
                if (valido) {
                    alert("me meto por aqui");
                    recuperarSesion();
                } else {
                    alert("faltan datos por concretar");
                }
            }
            
            function recuperarSesion(){
                $.ajax({
                    url: 'http://localhost/TrivialWarsServer/web/app_dev.php/trivial/user/auth',
                    method: 'POST',
                    dataType: 'json',
                    success: function(data) {
                        alert("segundo"+data.id);
                        numJugadores = numeroJugadores();
                        var datos = {"jugadores" : numJugadores, "ficha" : fichaSelec, "nombre" : nombrePartida, "id" : data.id};
                        if (data.autenticado) {
                            $.ajax({
                            url: 'http://localhost/TrivialWarsServer/web/app_dev.php/trivial/game/create',
                            method: 'POST',
                            dataType: 'json',
                            data: datos,
                            success: function(data) {
                                if (data) {
                                    alert("dpm");
                                    socket.emit("crear_partida", {sala: nombrePartida});
                                }
                            },
                            error: function(error) {
                                alert("error");
                            }
                        });
                        } else {
                            window.location = "/TrivialWarsClient/public_html/index.html";
                        }
                    },
                    error: function(error) {
                        window.location = "/TrivialWarsClient/public_html/index.html";
                    }
                });
            }            
            
            function numeroJugadores(){
                var boton = document.getElementsByName("radiog_lite");
                
                if(boton[0].checked){
                    return 2;
                }
                if(boton[1].checked){
                    return 3;
                }
                if(boton[2].checked){
                    return 4;
                    
                }
            }

            function validarDatos() {
                nombrePartida = $("#gameName").val();
                if(nombrePartida === ""){
                    alert("falta el nombre");
                    return false;
                }
                if (fichaSelec === ""){
                    alert("falta la ficha");
                    return false;
                }
                return true;
            }
            

            $(document).ready(function() {

                $('#cssmenu ul ul li:odd').addClass('odd');
                $('#cssmenu ul ul li:even').addClass('even');
                $('#cssmenu > ul > li > a').click(function() {
                    $('#cssmenu li').removeClass('active');
                    $(this).closest('li').addClass('active');
                    var checkElement = $(this).next();
                    if ((checkElement.is('ul')) && (checkElement.is(':visible'))) {
                        $(this).closest('li').removeClass('active');
                        checkElement.slideUp('normal');
                    }
                    if ((checkElement.is('ul')) && (!checkElement.is(':visible'))) {
                        $('#cssmenu ul ul:visible').slideUp('normal');
                        checkElement.slideDown('normal');
                    }
                    if ($(this).closest('li').find('ul').children().length == 0) {
                        return true;
                    } else {
                        return false;
                    }
                });
            });

        </script>
    </head>
    <body>
        <div id="cabecera">
            <div id="logo">
                <h1 id="titulo">trivial wars</h1>
            </div>
        </div>

        <div id="gameData">
            <table>
                <tr>
                    <td>
                        Nombre Partida:<br/>
                        <input type = 'text' id="gameName" name = 'gameName' title="Se necesita un nombre de partida" required/>    
                    </td>
                    <td>
                        <table>
                            <tbody>
                                <tr>
                                    <td class="gamers" colspan="3">
                                        <h4>Numero de Jugadores</h4>                            
                                    </td>
                                </tr>
                                <tr>
                                    <td class="gamers">
                                        <input type="radio" name="radiog_lite" id="radio1" class="css-checkbox" >
                                        <label for="radio1" class="css-label">2</label>
                                    </td>
                                    <td class="gamers">
                                        <input type="radio" name="radiog_lite" id="radio2" class="css-checkbox" checked="checked">
                                        <label for="radio2" class="css-label">3</label>
                                    </td>
                                    <td class="gamers">
                                        <input type="radio" name="radiog_lite" id="radio3" class="css-checkbox">
                                        <label for="radio3" class="css-label">4</label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <button id="confirm" onclick="confirmarDatosPartida()" onmouseover="document.getElementById('sablelaser').play()">Confirmar Datos</button>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div id="waitPlayers">
                            <p>Esperando Jugadores</p>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <div id="chips"> 
            <table>
                <tr>
                    <td colspan="4">Elegir ficha:
                        <input type = 'text' id="nameFich" name = 'nameFich' readonly/>    </td>
                </tr>
                <tr>
                    <td class="chipsImages" id="c3po"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('c3po', 'c3po.jpg')" src="resources/images/c3po.jpg"/><span>C3PO</span></a></td>
                    <td class="chipsImages" id="darthvader"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('darth vader', 'darthvader.jpg')" src="resources/images/darthvader.jpg"/><span>Darth Vader</span></a></td>
                    <td class="chipsImages" id="darthsidious"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('darth sidious', 'darthsidious.jpg')" src="resources/images/darthsidious.jpg"/><span>Darth Sidious</span></a></td>
                    <td class="chipsImages" id="hansolo"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('han solo', 'hansolo.jpg')" src="resources/images/hansolo.jpg"/><span>Han Solo</span></a></td>
                </tr>
                <tr>
                    <td class="chipsImages" id="leia"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('leia', 'leia.jpg')" src="resources/images/leia.jpg"/><span>Leia</span></a></td>
                    <td class="chipsImages" id="luke"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('luke', 'luke.jpg')" src="resources/images/luke.jpg"/><span>Luke</span></a></td>
                    <td class="chipsImages" id="obiwan"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('obi-wan', 'obiwan.jpg')" src="resources/images/obiwan.jpg"/><span>Obi-Wan</span></a></td>
                    <td class="chipsImages" id="obiwan"><a href="#" class="Ntooltip"><img onclick="fichaSeleccionada('r2d2', 'r2d2.jpg')" src="resources/images/r2d2.jpg"/><span>R2D2</span></a></td>
                </tr>
            </table>
        </div>

        <!--        <div id="dialog" title="Registro">
                    <p id="titleReg" class="validateTips">Todos los campos son requeridos.</p>
                    <form id="regUsuarios">
                        <fieldset id="registro">
                            <label for="name">Nombre (*)</label><br/>
                            <input type="text" name="nameReg" id="nameReg" class="text ui-widget-content ui-corner-all inputRegister"><br/>
                            <label for="password">Contraseña (*)</label><br/>
                            <input type="password" name="passwordReg" id="passwordReg" value="" class="text ui-widget-content ui-corner-all inputRegister"><br/>
                            <label for="email">E-mail</label><br/>
                            <input type="text" name="emailReg" id="emailReg" value="" class="text ui-widget-content ui-corner-all inputRegister"><br/>
                        </fieldset>
                        <fieldset id="regOK">
                            <label>¡Enhorabuena! Eres parte de la galaxia...</label>
                        </fieldset>
                    </form>
                </div>-->


    </body>
</html>
